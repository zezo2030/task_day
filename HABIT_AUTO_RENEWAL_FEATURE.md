# ✨ ميزة التجديد التلقائي للعادات

## 📋 نظرة عامة

تم إضافة ميزة التجديد التلقائي للعادات إلى التطبيق، والتي تقوم تلقائياً بإعادة تعيين حالة العادات عند بداية كل يوم جديد.

## 🔄 كيف تعمل الميزة

### 1. التجديد التلقائي
- **عند فتح التطبيق**: يتم فحص ما إذا كان اليوم جديد أم لا
- **إذا كان يوم جديد**: يتم تلقائياً إعادة تعيين جميع العادات
- **للعادات القابلة للقياس**: يتم إعادة تعيين `currentValue` إلى `0`
- **للعادات غير القابلة للقياس**: يتم إعادة تعيين `isDone` إلى `false`

### 2. حفظ آخر تاريخ تجديد
- يتم حفظ تاريخ آخر تجديد في قاعدة البيانات المحلية
- يتم مقارنة التاريخ الحالي مع آخر تاريخ تجديد
- إذا كان التاريخ الحالي أحدث، يتم تنفيذ التجديد

## 🎯 الملفات المُحدثة

### 1. `lib/services/hive_service.dart`
```dart
// إضافة box جديد للإعدادات
static const String settingsBoxName = 'settings';

// وظائف جديدة:
- checkAndPerformDailyReset()      // فحص وتنفيذ التجديد التلقائي
- performDailyHabitsReset()        // تنفيذ التجديد لجميع العادات
- manualDailyReset()               // تجديد يدوي
- getLastResetDate()               // الحصول على آخر تاريخ تجديد
- getSettingsBox()                 // الحصول على صندوق الإعدادات
```

### 2. `lib/controller/habit_cubit/habit_cubit.dart`
```dart
// وظائف جديدة:
- performDailyReset()              // تجديد يدوي من خلال Cubit
- getLastResetDate()               // الحصول على آخر تاريخ تجديد
```

### 3. `lib/view/habits_screen.dart`
```dart
// إضافات جديدة:
- زر تجديد يدوي (🔄) بجانب زر إضافة العادة
- مؤشر آخر تجديد في أعلى الشاشة
- حوار تأكيد للتجديد اليدوي
- رسالة تأكيد بعد التجديد

// وظائف جديدة:
- _showResetConfirmDialog()        // عرض حوار التأكيد
- _performDailyReset()             // تنفيذ التجديد اليدوي
- _buildLastResetInfo()            // بناء مؤشر آخر تجديد
```

## 🚀 كيفية الاستخدام

### التجديد التلقائي
1. **لا يتطلب أي تدخل من المستخدم**
2. يحدث تلقائياً عند فتح التطبيق إذا كان يوم جديد
3. يظهر مؤشر في أعلى شاشة العادات يوضح آخر تاريخ تجديد

### التجديد اليدوي
1. **افتح شاشة العادات**
2. **اضغط على زر التجديد (🔄)** البرتقالي في الأسفل
3. **أكد التجديد** في حوار التأكيد
4. **ستظهر رسالة تأكيد** وسيتم تحديث جميع العادات

## 📊 مؤشر حالة التجديد

في أعلى شاشة العادات، ستجد مؤشر يوضح:
- **"Reset today at HH:mm"** - إذا تم التجديد اليوم (🟢 أخضر)
- **"Last reset: X days ago"** - إذا كان آخر تجديد منذ أيام (🟠 برتقالي)
- **"Never reset"** - إذا لم يتم التجديد مطلقاً (🟠 برتقالي)

## ⚙️ التفاصيل التقنية

### تدفق البيانات
```
تشغيل التطبيق → HiveService.init() → checkAndPerformDailyReset() 
↓
فحص آخر تاريخ تجديد من settingsBox
↓
مقارنة مع التاريخ الحالي
↓
إذا كان يوم جديد → performDailyHabitsReset()
↓
حفظ تاريخ التجديد الجديد
```

### تخزين البيانات
- **آخر تاريخ تجديد**: يُحفظ في `settingsBox` تحت مفتاح `'lastResetDate'`
- **صيغة التاريخ**: ISO 8601 string format
- **فحص التاريخ**: مقارنة اليوم الحالي مع آخر يوم تم فيه التجديد

## 🔒 الأمان والاستقرار

### منع التجديد المتكرر
- يتم التحقق من التاريخ قبل كل تجديد
- لا يمكن التجديد أكثر من مرة في اليوم الواحد تلقائياً
- التجديد اليدوي متاح دائماً للاختبار

### معالجة الأخطاء
- جميع العمليات محاطة بـ `try-catch`
- رسائل خطأ واضحة في وضع التطوير
- عدم توقف التطبيق في حالة فشل التجديد

## 🧪 الاختبار

### اختبار التجديد التلقائي
1. أنشئ بعض العادات وأكملها
2. أغلق التطبيق
3. غيّر تاريخ النظام لليوم التالي
4. افتح التطبيق مرة أخرى
5. تأكد من إعادة تعيين العادات

### اختبار التجديد اليدوي
1. أكمل بعض العادات
2. اضغط زر التجديد اليدوي
3. أكد في حوار التأكيد
4. تأكد من إعادة تعيين العادات

## 📝 ملاحظات مهمة

- **تواريخ الإكمال**: لا تتأثر بالتجديد، تبقى محفوظة في `completedDates`
- **الإحصائيات**: تُحسب بناءً على تواريخ الإكمال، لا القيم الحالية
- **السلاسل (Streaks)**: تعتمد على تواريخ الإكمال المحفوظة
- **البيانات الشخصية**: لا تتأثر (العنوان، الوصف، الألوان، الأهداف)

## 🎉 المزايا

✅ **تلقائية بالكامل** - لا تحتاج تدخل المستخدم  
✅ **حفظ التاريخ** - تواريخ الإكمال محفوظة للإحصائيات  
✅ **مرونة** - إمكانية التجديد اليدوي  
✅ **مؤشرات واضحة** - معلومات عن آخر تجديد  
✅ **أمان** - منع التجديد المتكرر  
✅ **استقرار** - معالجة شاملة للأخطاء  

---

**🚀 الميزة جاهزة للاستخدام!** 